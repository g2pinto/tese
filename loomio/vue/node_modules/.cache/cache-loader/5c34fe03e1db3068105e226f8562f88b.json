{"remainingRequest":"/home/gustavo/Documents/tese/loomio/vue/node_modules/babel-loader/lib/index.js!/home/gustavo/Documents/tese/loomio/vue/node_modules/vue-cli-plugin-coffee/node_modules/coffee-loader/dist/cjs.js!/home/gustavo/Documents/tese/loomio/vue/src/shared/services/auth_service.coffee","dependencies":[{"path":"/home/gustavo/Documents/tese/loomio/vue/src/shared/services/auth_service.coffee","mtime":1706724415812},{"path":"/home/gustavo/Documents/tese/loomio/vue/.babelrc","mtime":1706724415792},{"path":"/home/gustavo/Documents/tese/loomio/vue/node_modules/vue-cli-plugin-coffee/node_modules/cache-loader/dist/cjs.js","mtime":1706724497848},{"path":"/home/gustavo/Documents/tese/loomio/vue/node_modules/babel-loader/lib/index.js","mtime":1706724500796},{"path":"/home/gustavo/Documents/tese/loomio/vue/node_modules/vue-cli-plugin-coffee/node_modules/coffee-loader/dist/cjs.js","mtime":1706724497848}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9rZXlzIGZyb20gImxvZGFzaC9rZXlzIjsKaW1wb3J0IF9waWNrIGZyb20gImxvZGFzaC9waWNrIjsKaW1wb3J0IF9tYXBLZXlzIGZyb20gImxvZGFzaC9tYXBLZXlzIjsKaW1wb3J0IF9jYW1lbENhc2UgZnJvbSAibG9kYXNoL2NhbWVsQ2FzZSI7CmltcG9ydCBfcGlja0J5IGZyb20gImxvZGFzaC9waWNrQnkiOwppbXBvcnQgX2hlYWQgZnJvbSAibG9kYXNoL2hlYWQiOwp2YXIgQXV0aFNlcnZpY2U7CmltcG9ydCBBcHBDb25maWcgZnJvbSAnQC9zaGFyZWQvc2VydmljZXMvYXBwX2NvbmZpZyc7CmltcG9ydCBSZWNvcmRzIGZyb20gJ0Avc2hhcmVkL3NlcnZpY2VzL3JlY29yZHMnOwppbXBvcnQgU2Vzc2lvbiBmcm9tICdAL3NoYXJlZC9zZXJ2aWNlcy9zZXNzaW9uJzsKaW1wb3J0IEV2ZW50QnVzIGZyb20gJ0Avc2hhcmVkL3NlcnZpY2VzL2V2ZW50X2J1cyc7CmltcG9ydCBGbGFzaCBmcm9tICdAL3NoYXJlZC9zZXJ2aWNlcy9mbGFzaCc7CmltcG9ydCBpMThuIGZyb20gJ0AvaTE4bi5jb2ZmZWUnOwpleHBvcnQgZGVmYXVsdCBuZXcgKEF1dGhTZXJ2aWNlID0gY2xhc3MgQXV0aFNlcnZpY2UgewogIGVtYWlsU3RhdHVzKHVzZXIpIHsKICAgIHZhciBwZW5kaW5nVG9rZW47CiAgICBwZW5kaW5nVG9rZW4gPSAoQXBwQ29uZmlnLnBlbmRpbmdJZGVudGl0eSB8fCB7fSkudG9rZW47CiAgICByZXR1cm4gUmVjb3Jkcy51c2Vycy5lbWFpbFN0YXR1cyh1c2VyLmVtYWlsLCBwZW5kaW5nVG9rZW4pLnRoZW4oZGF0YSA9PiB7CiAgICAgIHJldHVybiB0aGlzLmFwcGx5RW1haWxTdGF0dXModXNlciwgX2hlYWQoZGF0YS51c2VycykpOwogICAgfSk7CiAgfQoKICBhcHBseUVtYWlsU3RhdHVzKHVzZXIpIHsKICAgIGxldCBkYXRhID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgIHZhciB2YWxzOwogICAgdmFscyA9IFsnbmFtZScsICdlbWFpbCcsICdhdmF0YXJfa2luZCcsICdhdmF0YXJfaW5pdGlhbHMnLCAnZW1haWxfaGFzaCcsICdhdmF0YXJfdXJsJywgJ2hhc19wYXNzd29yZCcsICdlbWFpbF9zdGF0dXMnLCAnZW1haWxfdmVyaWZpZWQnLCAnbGVnYWxfYWNjZXB0ZWRfYXQnLCAnYXV0aF9mb3JtJ107CiAgICB1c2VyLnVwZGF0ZShfcGlja0J5KF9tYXBLZXlzKF9waWNrKGRhdGEsIHZhbHMpLCBmdW5jdGlvbiAodiwgaykgewogICAgICByZXR1cm4gX2NhbWVsQ2FzZShrKTsKICAgIH0pLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgIHJldHVybiAhIXZhbDsKICAgIH0pKTsKICAgIHVzZXIudXBkYXRlKHsKICAgICAgaGFzVG9rZW46IGRhdGEuaGFzX3Rva2VuCiAgICB9KTsKICAgIHJldHVybiB1c2VyOwogIH0KCiAgYXV0aFN1Y2Nlc3MoZGF0YSkgewogICAgdmFyIHVzZXI7CiAgICB1c2VyID0gU2Vzc2lvbi5hcHBseShkYXRhKTsKICAgIEV2ZW50QnVzLiRlbWl0KCdjbG9zZU1vZGFsJyk7CiAgICByZXR1cm4gRmxhc2guc3VjY2VzcygnYXV0aF9mb3JtLnNpZ25lZF9pbicpOwogIH0KCiAgc2lnbkluKCkgewogICAgbGV0IHVzZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgbGV0IG9uU3VjY2VzcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZnVuY3Rpb24gKCkge307CiAgICBsZXQgb25GYWlsdXJlID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBmdW5jdGlvbiAoKSB7fTsKICAgIHJldHVybiBSZWNvcmRzLnNlc3Npb25zLmJ1aWxkKF9waWNrKHVzZXIsIFsnZW1haWwnLCAnbmFtZScsICdwYXNzd29yZCcsICdjb2RlJ10pKS5zYXZlKCkudGhlbihkYXRhID0+IHsKICAgICAgdGhpcy5hdXRoU3VjY2VzcyhkYXRhKTsKICAgICAgb25TdWNjZXNzKGRhdGEpOwogICAgICByZXR1cm4gZGF0YTsKICAgIH0sIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgdmFyIGVycm9yczsKICAgICAgZXJyb3JzID0gdXNlci5oYXNUb2tlbiA/IHsKICAgICAgICB0b2tlbjogW2kxOG4udCgnYXV0aF9mb3JtLmludmFsaWRfdG9rZW4nKV0KICAgICAgfSA6IHsKICAgICAgICBwYXNzd29yZDogW2kxOG4udCgnYXV0aF9mb3JtLmludmFsaWRfcGFzc3dvcmQnKV0KICAgICAgfTsKICAgICAgcmV0dXJuIHVzZXIudXBkYXRlKHsKICAgICAgICBlcnJvcnM6IGVycm9ycwogICAgICB9KTsKICAgIH0pOwogIH0KCiAgc2lnblVwKHVzZXIpIHsKICAgIGxldCBvblN1Y2Nlc3MgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZ1bmN0aW9uICgpIHt9OwogICAgbGV0IG9uRmFpbHVyZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogZnVuY3Rpb24gKCkge307CiAgICByZXR1cm4gUmVjb3Jkcy5yZWdpc3RyYXRpb25zLmJ1aWxkKF9waWNrKHVzZXIsIFsnZW1haWwnLCAnbmFtZScsICdyZWNhcHRjaGEnLCAnbGVnYWxBY2NlcHRlZCcsICdlbWFpbE5ld3NsZXR0ZXInXSkpLnNhdmUoKS50aGVuKGRhdGEgPT4gewogICAgICBpZiAodXNlci5oYXNUb2tlbiB8fCBkYXRhLnNpZ25lZF9pbikgewogICAgICAgIHRoaXMuYXV0aFN1Y2Nlc3MoZGF0YSk7CiAgICAgICAgb25TdWNjZXNzKGRhdGEpOwogICAgICB9IGVsc2UgewogICAgICAgIHVzZXIudXBkYXRlKHsKICAgICAgICAgIGF1dGhGb3JtOiAnY29tcGxldGUnLAogICAgICAgICAgc2VudExvZ2luTGluazogdHJ1ZQogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gZGF0YTsKICAgIH0sIGRhdGEgPT4gewogICAgICByZXR1cm4gdXNlci5lcnJvcnMgPSBkYXRhLmVycm9yczsKICAgIH0pOwogIH0KCiAgcmVhY3RpdmF0ZSh1c2VyKSB7CiAgICByZXR1cm4gUmVjb3Jkcy51c2Vycy5yZWFjdGl2YXRlKHVzZXIpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdXNlci51cGRhdGUoewogICAgICAgIHNlbnRMb2dpbkxpbms6IHRydWUKICAgICAgfSk7CiAgICB9KTsKICB9CgogIHNlbmRMb2dpbkxpbmsodXNlcikgewogICAgcmV0dXJuIFJlY29yZHMubG9naW5Ub2tlbnMuZmV0Y2hUb2tlbih1c2VyLmVtYWlsKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHVzZXIudXBkYXRlKHsKICAgICAgICBhdXRoRm9ybTogJ2NvbXBsZXRlJywKICAgICAgICBzZW50TG9naW5MaW5rOiB0cnVlCiAgICAgIH0pOwogICAgfSk7CiAgfQoKICB2YWxpZFNpZ251cCh2YXJzLCB1c2VyKSB7CiAgICB1c2VyLmVycm9ycyA9IHt9OwoKICAgIGlmICghdmFycy5uYW1lKSB7CiAgICAgIHVzZXIuZXJyb3JzLm5hbWUgPSBbaTE4bi50KCdhdXRoX2Zvcm0ubmFtZV9yZXF1aXJlZCcpXTsKICAgIH0KCiAgICBpZiAoQXBwQ29uZmlnLnRoZW1lLnRlcm1zX3VybCAmJiAhdmFycy5sZWdhbEFjY2VwdGVkKSB7CiAgICAgIHVzZXIuZXJyb3JzLmxlZ2FsQWNjZXB0ZWQgPSBbaTE4bi50KCdhdXRoX2Zvcm0udGVybXNfcmVxdWlyZWQnKV07CiAgICB9CgogICAgaWYgKF9rZXlzKHVzZXIuZXJyb3JzKSkgewogICAgICB1c2VyLm5hbWUgPSB2YXJzLm5hbWU7CiAgICAgIHVzZXIubGVnYWxBY2NlcHRlZCA9IHZhcnMubGVnYWxBY2NlcHRlZDsKICAgICAgdXNlci5lbWFpbE5ld3NsZXR0ZXIgPSB2YXJzLmVtYWlsTmV3c2xldHRlcjsKICAgIH0KCiAgICByZXR1cm4gX2tleXModXNlci5lcnJvcnMpLmxlbmd0aCA9PT0gMDsKICB9Cgp9KSgpOw=="},{"version":3,"sources":["/home/gustavo/Documents/tese/loomio/vue/src/shared/services/auth_service.coffee"],"names":[],"mappings":";;;;;;AAAA,IAAA,WAAA;AAAA,OAAA,SAAA,MAAA,8BAAA;AACA,OAAA,OAAA,MAAA,2BAAA;AACA,OAAA,OAAA,MAAA,2BAAA;AACA,OAAA,QAAA,MAAA,6BAAA;AACA,OAAA,KAAA,MAAA,yBAAA;AACA,OAAA,IAAA,MAAA,eAAA;AAGA,eAAe,KAAU,WAAA,GAAN,MAAA,WAAA,CAAA;AACjB,EAAA,WAAa,CAAA,IAAA,EAAA;AACf,QAAA,YAAA;AAAI,IAAA,YAAA,GAAe,CAAC,SAAS,CAAT,eAAA,IAAD,EAAA,EAAkC,KAAjD;WACA,OAAO,CAAC,KAAR,CAAA,WAAA,CAA0B,IAAI,CAA9B,KAAA,EAAA,YAAA,EAAA,IAAA,CAAyD,IAAA,IAAA;aACvD,KAAA,gBAAA,CAAA,IAAA,EAAwB,MAAK,IAAI,CAAjC,KAAwB,CAAxB,C;AADF,KAAA,C;AAFW;;AAKb,EAAA,gBAAkB,CAAA,IAAA,EAAA;AAAA,QAAO,IAAP,uEAAA,EAAA;AACpB,QAAA,IAAA;AAAI,IAAA,IAAA,GAAO,CAAA,MAAA,EAAA,OAAA,EAAA,aAAA,EAAA,iBAAA,EAAA,YAAA,EAAA,YAAA,EAAA,cAAA,EAAA,cAAA,EAAA,gBAAA,EAAA,mBAAA,EAAA,WAAA,CAAP;AAGA,IAAA,IAAI,CAAJ,MAAA,CAAY,QAAO,SAAQ,MAAA,IAAA,EAAR,IAAQ,CAAR,EAA0B,UAAA,CAAA,EAAA,CAAA,EAAA;aAAS,WAAA,CAAA,C;AAA1C,KAAO,CAAP,EAAyD,UAAA,GAAA,EAAA;aAAS,CAAC,CAAC,G;AAAhF,KAAY,CAAZ;AACA,IAAA,IAAI,CAAJ,MAAA,CAAY;AAAA,MAAA,QAAA,EAAU,IAAI,CAAC;AAAf,KAAZ;WACA,I;AANgB;;AAQlB,EAAA,WAAa,CAAA,IAAA,EAAA;AACf,QAAA,IAAA;AAAI,IAAA,IAAA,GAAO,OAAO,CAAP,KAAA,CAAA,IAAA,CAAP;AACA,IAAA,QAAQ,CAAR,KAAA,CAAA,YAAA;WACA,KAAK,CAAL,OAAA,CAAA,qBAAA,C;AAHW;;AAOb,EAAA,MAAQ,GAAA;AAAA,QAAC,IAAD,uEAAA,EAAA;AAAA,QAAa,SAAb,uEAAyB,YAAA,CAAzB,CAAA;AAAA,QAA8B,SAA9B,uEAA0C,YAAA,CAA1C,CAAA;WACN,OAAO,CAAC,QAAR,CAAA,KAAA,CACE,MAAA,IAAA,EAAW,CAAA,OAAA,EAAA,MAAA,EAAA,UAAA,EADb,MACa,CAAX,CADF,EAAA,IAAA,GAAA,IAAA,CAEc,IAAA,IAAA;AACZ,WAAA,WAAA,CAAA,IAAA;AACA,MAAA,SAAA,CAAA,IAAA,CAAA;aACA,I;AALF,KAAA,EAME,UAAA,GAAA,EAAA;AACN,UAAA,MAAA;AAAM,MAAA,MAAA,GAAY,IAAI,CAAP,QAAG,GACV;AAAE,QAAA,KAAA,EAAO,CAAC,IAAI,CAAJ,CAAA,CAAD,yBAAC,CAAD;AAAT,OADU,GAGV;AAAE,QAAA,QAAA,EAAU,CAAC,IAAI,CAAJ,CAAA,CAAD,4BAAC,CAAD;AAAZ,OAHF;aAIA,IAAI,CAAJ,MAAA,CAAY;AAAA,QAAA,MAAA,EAAQ;AAAR,OAAZ,C;AAXF,KAAA,C;AADM;;AAcR,EAAA,MAAQ,CAAA,IAAA,EAAA;AAAA,QAAO,SAAP,uEAAmB,YAAA,CAAnB,CAAA;AAAA,QAAwB,SAAxB,uEAAoC,YAAA,CAApC,CAAA;WACN,OAAO,CAAC,aAAR,CAAA,KAAA,CACE,MAAA,IAAA,EAAW,CAAA,OAAA,EAAA,MAAA,EAAA,WAAA,EAAA,eAAA,EADb,iBACa,CAAX,CADF,EAAA,IAAA,GAAA,IAAA,CAEc,IAAA,IAAA;AACZ,UAAG,IAAI,CAAJ,QAAA,IAAiB,IAAI,CAAxB,SAAA,EAAA;AACE,aAAA,WAAA,CAAA,IAAA;AACA,QAAA,SAAA,CAFF,IAEE,CAAA;AAFF,OAAA,MAAA;AAIE,QAAA,IAAI,CAAJ,MAAA,CAAY;AAAC,UAAA,QAAA,EAAD,UAAA;AAAuB,UAAA,aAAA,EAAe;AAAtC,SAAZ;;;aACF,I;AARF,KAAA,EASE,IAAA,IAAA;aACA,IAAI,CAAJ,MAAA,GAAc,IAAI,CAAC,M;AAVrB,KAAA,C;AADM;;AAaR,EAAA,UAAY,CAAA,IAAA,EAAA;WACV,OAAO,CAAC,KAAR,CAAA,UAAA,CAAA,IAAA,EAAA,IAAA,CAAoC,YAAA;aAClC,IAAI,CAAJ,MAAA,CAAY;AAAC,QAAA,aAAA,EAAe;AAAhB,OAAZ,C;AADF,KAAA,C;AADU;;AAIZ,EAAA,aAAe,CAAA,IAAA,EAAA;WACb,OAAO,CAAC,WAAR,CAAA,UAAA,CAA+B,IAAI,CAAnC,KAAA,EAAA,IAAA,CAAgD,YAAA;aAC9C,IAAI,CAAJ,MAAA,CAAY;AAAC,QAAA,QAAA,EAAD,UAAA;AAAuB,QAAA,aAAA,EAAe;AAAtC,OAAZ,C;AADF,KAAA,C;AADa;;AAIf,EAAA,WAAa,CAAA,IAAA,EAAA,IAAA,EAAA;AACX,IAAA,IAAI,CAAJ,MAAA,GAAc,EAAd;;AAEA,QAAG,CAAC,IAAI,CAAR,IAAA,EAAA;AACE,MAAA,IAAI,CAAC,MAAL,CAAA,IAAA,GAAmB,CAAC,IAAI,CAAJ,CAAA,CADtB,yBACsB,CAAD,CAAnB;;;AAEF,QAAG,SAAS,CAAC,KAAV,CAAA,SAAA,IAA6B,CAAC,IAAI,CAArC,aAAA,EAAA;AACE,MAAA,IAAI,CAAC,MAAL,CAAA,aAAA,GAA4B,CAAC,IAAI,CAAJ,CAAA,CAD/B,0BAC+B,CAAD,CAA5B;;;AAEF,QAAG,MAAK,IAAI,CAAZ,MAAG,CAAH,EAAA;AACE,MAAA,IAAI,CAAJ,IAAA,GAAsB,IAAI,CAAC,IAA3B;AACA,MAAA,IAAI,CAAJ,aAAA,GAAsB,IAAI,CAAC,aAA3B;AACA,MAAA,IAAI,CAAJ,eAAA,GAAuB,IAAI,CAH7B,eAGE;;;AAEF,WAAO,MAAK,IAAI,CAAT,MAAA,EAAA,MAAA,KAA4B,CAAnC;AAdW;;AAxDI,CAAJ,GAAf","sourcesContent":["import AppConfig from '@/shared/services/app_config'\nimport Records   from '@/shared/services/records'\nimport Session from '@/shared/services/session'\nimport EventBus from '@/shared/services/event_bus'\nimport Flash from '@/shared/services/flash'\nimport i18n from '@/i18n.coffee'\nimport {head, pickBy, camelCase, mapKeys, map, pick, identity, keys} from 'lodash'\n\nexport default new class AuthService\n  emailStatus: (user) ->\n    pendingToken = (AppConfig.pendingIdentity or {}).token\n    Records.users.emailStatus(user.email, pendingToken).then (data) =>\n      @applyEmailStatus(user, head(data.users))\n\n  applyEmailStatus: (user, data = {}) ->\n    vals = ['name', 'email', 'avatar_kind', 'avatar_initials', 'email_hash',\n            'avatar_url', 'has_password', 'email_status', 'email_verified',\n            'legal_accepted_at', 'auth_form']\n    user.update pickBy(mapKeys(pick(data, vals), (v,k) -> camelCase(k)), (val) -> !!val)\n    user.update(hasToken: data.has_token)\n    user\n\n  authSuccess: (data) ->\n    user = Session.apply(data)\n    EventBus.$emit('closeModal')\n    Flash.success('auth_form.signed_in')\n\n\n\n  signIn: (user = {} , onSuccess = -> , onFailure = ->) ->\n    Records.sessions.build(\n      pick(user, ['email', 'name', 'password', 'code'])\n    ).save().then (data) =>\n      @authSuccess(data)\n      onSuccess(data)\n      data\n    , (err) ->\n      errors = if user.hasToken\n        { token: [i18n.t('auth_form.invalid_token')] }\n      else\n        { password: [i18n.t('auth_form.invalid_password')]}\n      user.update(errors: errors)\n\n  signUp: (user, onSuccess = -> , onFailure = -> ) ->\n    Records.registrations.build(\n      pick(user, ['email', 'name', 'recaptcha', 'legalAccepted', 'emailNewsletter'])\n    ).save().then (data) =>\n      if user.hasToken or data.signed_in\n        @authSuccess(data)\n        onSuccess(data)\n      else\n        user.update({authForm: 'complete', sentLoginLink: true})\n      data\n    , (data) =>\n      user.errors = data.errors\n\n  reactivate: (user) ->\n    Records.users.reactivate(user).then ->\n      user.update({sentLoginLink: true})\n\n  sendLoginLink: (user) ->\n    Records.loginTokens.fetchToken(user.email).then ->\n      user.update({authForm: 'complete', sentLoginLink: true})\n\n  validSignup: (vars, user) ->\n    user.errors = {}\n\n    if !vars.name\n      user.errors.name = [i18n.t('auth_form.name_required')]\n\n    if AppConfig.theme.terms_url && !vars.legalAccepted\n      user.errors.legalAccepted = [i18n.t('auth_form.terms_required')]\n\n    if keys(user.errors)\n      user.name           = vars.name\n      user.legalAccepted  = vars.legalAccepted\n      user.emailNewsletter = vars.emailNewsletter\n\n    return keys(user.errors).length == 0\n"],"sourceRoot":""}]}