{"remainingRequest":"/home/gustavo/Documents/tese/loomio/vue/node_modules/babel-loader/lib/index.js!/home/gustavo/Documents/tese/loomio/vue/node_modules/vue-cli-plugin-coffee/node_modules/coffee-loader/dist/cjs.js!/home/gustavo/Documents/tese/loomio/vue/src/shared/helpers/message_bus.coffee","dependencies":[{"path":"/home/gustavo/Documents/tese/loomio/vue/src/shared/helpers/message_bus.coffee","mtime":1706724415808},{"path":"/home/gustavo/Documents/tese/loomio/vue/.babelrc","mtime":1706724415792},{"path":"/home/gustavo/Documents/tese/loomio/vue/node_modules/vue-cli-plugin-coffee/node_modules/cache-loader/dist/cjs.js","mtime":1706724497848},{"path":"/home/gustavo/Documents/tese/loomio/vue/node_modules/babel-loader/lib/index.js","mtime":1706724500796},{"path":"/home/gustavo/Documents/tese/loomio/vue/node_modules/vue-cli-plugin-coffee/node_modules/coffee-loader/dist/cjs.js","mtime":1706724497848}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:dmFyIHJlY29yZHNTb2NrZXQsIHJvb21TY29yZXM7CmltcG9ydCBBcHBDb25maWcgZnJvbSAnQC9zaGFyZWQvc2VydmljZXMvYXBwX2NvbmZpZyc7CmltcG9ydCBTZXNzaW9uIGZyb20gJ0Avc2hhcmVkL3NlcnZpY2VzL3Nlc3Npb24nOwppbXBvcnQgUmVjb3JkcyBmcm9tICdAL3NoYXJlZC9zZXJ2aWNlcy9yZWNvcmRzJzsKaW1wb3J0IEZsYXNoIGZyb20gJ0Avc2hhcmVkL3NlcnZpY2VzL2ZsYXNoJzsKaW1wb3J0IEF1dGhTZXJ2aWNlIGZyb20gJ0Avc2hhcmVkL3NlcnZpY2VzL2F1dGhfc2VydmljZSc7CmltcG9ydCBBYmlsaXR5U2VydmljZSBmcm9tICdAL3NoYXJlZC9zZXJ2aWNlcy9hYmlsaXR5X3NlcnZpY2UnOwppbXBvcnQgRXZlbnRCdXMgZnJvbSAnQC9zaGFyZWQvc2VydmljZXMvZXZlbnRfYnVzJzsKaW1wb3J0IGlvIGZyb20gJ3NvY2tldC5pby1jbGllbnQnOwpyb29tU2NvcmVzID0ge307CnJlY29yZHNTb2NrZXQgPSBudWxsOwpleHBvcnQgdmFyIGluaXRMaXZlVXBkYXRlID0gZnVuY3Rpb24gKCkgewogIHZhciByZWNvcmRzQWRkcmVzczsKICByZWNvcmRzQWRkcmVzcyA9IFtBcHBDb25maWcudGhlbWUuY2hhbm5lbHNfdXJpLCAncmVjb3JkcyddLmpvaW4oJy8nKTsKICByZWNvcmRzU29ja2V0ID0gaW8ocmVjb3Jkc0FkZHJlc3MsIHsKICAgIHF1ZXJ5OiB7CiAgICAgIGNoYW5uZWxfdG9rZW46IEFwcENvbmZpZy5jaGFubmVsX3Rva2VuCiAgICB9CiAgfSk7CiAgcmVjb3Jkc1NvY2tldC5vbigndXBkYXRlJywgZGF0YSA9PiB7CiAgICBpZiAoZGF0YS5ub3RpY2UpIHsKICAgICAgcmV0dXJuIEV2ZW50QnVzLiRlbWl0KCdzeXN0ZW1Ob3RpY2UnLCBkYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIGNvbnNvbGUubG9nICdyZWNvcmRzIHVwZGF0ZScsIGRhdGEucm9vbSwgZGF0YS5yZWNvcmRzCiAgICAgIHJvb21TY29yZXNbZGF0YS5yb29tXSA9IGRhdGEuc2NvcmU7CiAgICAgIHJldHVybiBSZWNvcmRzLmltcG9ydEpTT04oZGF0YS5yZWNvcmRzKTsKICAgIH0KICB9KTsKICByZWNvcmRzU29ja2V0Lm9uKCdyZWNvbm5lY3QnLCBkYXRhID0+IHsKICAgIGNvbnNvbGUubG9nKCJzb2NrZXQuaW8gcmVjb25uZWN0IiwgewogICAgICByb29tU2NvcmVzOiByb29tU2NvcmVzCiAgICB9KTsKICAgIHJldHVybiByZWNvcmRzU29ja2V0LmVtaXQoImNhdGNodXAiLCByb29tU2NvcmVzLCByZWNvcmRTZXRzID0+IHsKICAgICAgY29uc29sZS5sb2coImNhdGNodXAgcmVwbHkiLCByZWNvcmRTZXRzKTsKICAgICAgcmV0dXJuIHJlY29yZFNldHMuZm9yRWFjaChzZXQgPT4gewogICAgICAgIHJldHVybiBSZWNvcmRzLmltcG9ydEpTT04oc2V0KTsKICAgICAgfSk7CiAgICB9KTsKICB9KTsKICByZWNvcmRzU29ja2V0Lm9uKCdkaXNjb25uZWN0JywgZGF0YSA9PiB7CiAgICAvLyBGbGFzaC53YXJuaW5nKCJzZXJ2ZXIgZGlzY29ubmVjdGVkIikKICAgIHJldHVybiBjb25zb2xlLmxvZygic29ja2V0LmlvIGRpc2Nvbm5lY3QiKTsKICB9KTsKICByZXR1cm4gcmVjb3Jkc1NvY2tldC5vbignY29ubmVjdCcsIGRhdGEgPT4gewogICAgLy8gRmxhc2gud2FybmluZygic2VydmVyIGNvbm5lY3RlZCIpCiAgICByZXR1cm4gY29uc29sZS5sb2coInNvY2tldC5pbyBjb25uZWN0Iik7CiAgfSk7Cn07CmV4cG9ydCB2YXIgY2xvc2VMaXZlVXBkYXRlID0gZnVuY3Rpb24gKCkgewogIHJldHVybiByZWNvcmRzU29ja2V0LmNsb3NlKCk7Cn07"},{"version":3,"sources":["/home/gustavo/Documents/tese/loomio/vue/src/shared/helpers/message_bus.coffee"],"names":[],"mappings":"AAAA,IAAA,aAAA,EAAA,UAAA;AAAA,OAAA,SAAA,MAAA,8BAAA;AACA,OAAA,OAAA,MAAA,2BAAA;AACA,OAAA,OAAA,MAAA,2BAAA;AACA,OAAA,KAAA,MAAA,yBAAA;AACA,OAAA,WAAA,MAAA,gCAAA;AACA,OAAA,cAAA,MAAA,mCAAA;AACA,OAAA,QAAA,MAAA,6BAAA;AAIA,OAAA,EAAA,MAAA,kBAAA;AAEA,UAAA,GAAa,EAAb;AACA,aAAA,GAAgB,IAAhB;AAEA,OAAA,IAAO,cAAA,GAAiB,YAAA;AACxB,MAAA,cAAA;AAAE,EAAA,cAAA,GAAiB,CAAC,SAAS,CAAC,KAAV,CAAD,YAAA,EAAA,SAAA,EAAA,IAAA,CAAA,GAAA,CAAjB;AACA,EAAA,aAAA,GAAgB,EAAA,CAAA,cAAA,EAAmB;AAAA,IAAA,KAAA,EAAO;AAAE,MAAA,aAAA,EAAe,SAAS,CAAC;AAA3B;AAAP,GAAnB,CAAhB;AAEA,EAAA,aAAa,CAAb,EAAA,CAAA,QAAA,EAA2B,IAAA,IAAA;AACzB,QAAG,IAAI,CAAP,MAAA,EAAA;aACE,QAAQ,CAAR,KAAA,CAAA,cAAA,EADF,IACE,C;AADF,KAAA,MAAA;;AAIE,MAAA,UAAU,CAAC,IAAI,CAAf,IAAU,CAAV,GAAwB,IAAI,CAAC,KAA7B;aACA,OAAO,CAAP,UAAA,CAAmB,IAAI,CALzB,OAKE,C;;AANJ,GAAA;AAQA,EAAA,aAAa,CAAb,EAAA,CAAA,WAAA,EAA8B,IAAA,IAAA;AAC5B,IAAA,OAAO,CAAP,GAAA,CAAA,qBAAA,EAAmC;AAAC,MAAA,UAAA,EAAY;AAAb,KAAnC;WACA,aAAa,CAAb,IAAA,CAAA,SAAA,EAAA,UAAA,EAA0C,UAAA,IAAA;AACxC,MAAA,OAAO,CAAP,GAAA,CAAA,eAAA,EAAA,UAAA;aACA,UAAU,CAAV,OAAA,CAAmB,GAAA,IAAA;eAAS,OAAO,CAAP,UAAA,CAAA,GAAA,C;AAA5B,OAAA,C;AAFF,KAAA,C;AAFF,GAAA;AAMA,EAAA,aAAa,CAAb,EAAA,CAAA,YAAA,EAA+B,IAAA,IAAA;;WAE7B,OAAO,CAAP,GAAA,CAAA,sBAAA,C;AAFF,GAAA;SAIA,aAAa,CAAb,EAAA,CAAA,SAAA,EAA4B,IAAA,IAAA;;WAE1B,OAAO,CAAP,GAAA,CAAA,mBAAA,C;AAFF,GAAA,C;AAtBsB,CAAxB;AA0BA,OAAA,IAAO,eAAA,GAAkB,YAAA;SACvB,aAAa,CAAb,KAAA,E;AADuB,CAAzB","sourcesContent":["import AppConfig      from '@/shared/services/app_config'\nimport Session        from '@/shared/services/session'\nimport Records        from '@/shared/services/records'\nimport Flash   from '@/shared/services/flash'\nimport AuthService    from '@/shared/services/auth_service'\nimport AbilityService from '@/shared/services/ability_service'\nimport EventBus       from '@/shared/services/event_bus'\n\nimport { each } from 'lodash'\n\nimport io from 'socket.io-client'\n\nroomScores = {}\nrecordsSocket = null\n\nexport initLiveUpdate = ->\n  recordsAddress = [AppConfig.theme.channels_uri, 'records'].join('/')\n  recordsSocket = io(recordsAddress, query: { channel_token: AppConfig.channel_token})\n\n  recordsSocket.on 'update', (data) =>\n    if data.notice\n      EventBus.$emit('systemNotice', data)\n    else\n      # console.log 'records update', data.room, data.records\n      roomScores[data.room] = data.score\n      Records.importJSON(data.records)\n\n  recordsSocket.on 'reconnect', (data) =>\n    console.log(\"socket.io reconnect\", {roomScores: roomScores})\n    recordsSocket.emit \"catchup\", roomScores, (recordSets) =>\n      console.log(\"catchup reply\", recordSets)\n      recordSets.forEach((set) => Records.importJSON(set))\n\n  recordsSocket.on 'disconnect', (data) =>\n    # Flash.warning(\"server disconnected\")\n    console.log(\"socket.io disconnect\")\n\n  recordsSocket.on 'connect', (data) =>\n    # Flash.warning(\"server connected\")\n    console.log(\"socket.io connect\")\n\nexport closeLiveUpdate = ->\n  recordsSocket.close()\n"],"sourceRoot":""}]}