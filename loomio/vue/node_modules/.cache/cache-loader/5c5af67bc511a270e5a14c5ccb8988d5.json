{"remainingRequest":"/home/gustavo/Documents/tese/loomio/vue/node_modules/babel-loader/lib/index.js!/home/gustavo/Documents/tese/loomio/vue/node_modules/vue-cli-plugin-coffee/node_modules/coffee-loader/dist/cjs.js!/home/gustavo/Documents/tese/loomio/vue/src/shared/services/session.coffee","dependencies":[{"path":"/home/gustavo/Documents/tese/loomio/vue/src/shared/services/session.coffee","mtime":1706724415812},{"path":"/home/gustavo/Documents/tese/loomio/vue/.babelrc","mtime":1706724415792},{"path":"/home/gustavo/Documents/tese/loomio/vue/node_modules/vue-cli-plugin-coffee/node_modules/cache-loader/dist/cjs.js","mtime":1706724497848},{"path":"/home/gustavo/Documents/tese/loomio/vue/node_modules/babel-loader/lib/index.js","mtime":1706724500796},{"path":"/home/gustavo/Documents/tese/loomio/vue/node_modules/vue-cli-plugin-coffee/node_modules/coffee-loader/dist/cjs.js","mtime":1706724497848}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jb21wYWN0IGZyb20gImxvZGFzaC9jb21wYWN0IjsKdmFyIFNlc3Npb24sIGRhdGVGbnNMb2NhbGUsIGZpeENhc2UsIGxvYWRMb2NhbGUsIGxvYWRlZExvY2FsZXMsIGxvb21pb0xvY2FsZSwgc2V0STE4bkxhbmd1YWdlOwppbXBvcnQgQXBwQ29uZmlnIGZyb20gJ0Avc2hhcmVkL3NlcnZpY2VzL2FwcF9jb25maWcnOwppbXBvcnQgUmVjb3JkcyBmcm9tICdAL3NoYXJlZC9zZXJ2aWNlcy9yZWNvcmRzJzsKaW1wb3J0IExtb1VybFNlcnZpY2UgZnJvbSAnQC9zaGFyZWQvc2VydmljZXMvbG1vX3VybF9zZXJ2aWNlJzsKaW1wb3J0IFJlc3RmdWxDbGllbnQgZnJvbSAnQC9zaGFyZWQvcmVjb3JkX3N0b3JlL3Jlc3RmdWxfY2xpZW50JzsKaW1wb3J0IEV2ZW50QnVzIGZyb20gJ0Avc2hhcmVkL3NlcnZpY2VzL2V2ZW50X2J1cyc7CmltcG9ydCBpMThuIGZyb20gJ0AvaTE4bic7CmltcG9ydCBWdWUgZnJvbSAndnVlJzsKaW1wb3J0IHsgaGFyZFJlbG9hZCB9IGZyb20gJ0Avc2hhcmVkL2hlbHBlcnMvd2luZG93JzsKbG9hZGVkTG9jYWxlcyA9IFsnZW4nXTsKCnNldEkxOG5MYW5ndWFnZSA9IGZ1bmN0aW9uIChsb2NhbGUpIHsKICBpMThuLmxvY2FsZSA9IGxvY2FsZTsKICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaHRtbCcpLnNldEF0dHJpYnV0ZSgnbGFuZycsIGxvY2FsZSk7Cn07CgpmaXhDYXNlID0gZnVuY3Rpb24gKGxvY2FsZSkgewogIHZhciBzcGxpdHM7CiAgc3BsaXRzID0gbG9jYWxlLnJlcGxhY2UoJy0nLCAnXycpLnNwbGl0KCdfJyk7CiAgcmV0dXJuIF9jb21wYWN0KFtzcGxpdHNbMF0udG9Mb3dlckNhc2UoKSwgc3BsaXRzWzFdICYmIHNwbGl0c1sxXS50b1VwcGVyQ2FzZSgpXSkuam9pbignXycpOwp9OwoKbG9vbWlvTG9jYWxlID0gZnVuY3Rpb24gKGxvY2FsZSkgewogIHJldHVybiBsb2NhbGUucmVwbGFjZSgnLScsICdfJyk7Cn07CgpkYXRlRm5zTG9jYWxlID0gZnVuY3Rpb24gKGxvY2FsZSkgewogIGlmIChsb2NhbGUuc3RhcnRzV2l0aCgnbmwnKSkgewogICAgcmV0dXJuICdubCc7CiAgfQoKICByZXR1cm4gbG9jYWxlLnJlcGxhY2UoJ18nLCAnLScpOwp9OwoKbG9hZExvY2FsZSA9IGZ1bmN0aW9uIChsb2NhbGUpIHsKICBpZiAoaTE4bi5sb2NhbGUgIT09IGxvY2FsZSkgewogICAgaWYgKGxvYWRlZExvY2FsZXMuaW5jbHVkZXMobG9jYWxlKSkgewogICAgICByZXR1cm4gc2V0STE4bkxhbmd1YWdlKGxvY2FsZSk7CiAgICB9IGVsc2UgewogICAgICBpbXBvcnQoYGRhdGUtZm5zL2xvY2FsZS8ke2RhdGVGbnNMb2NhbGUobG9jYWxlKX0vaW5kZXguanNgKS50aGVuKGZ1bmN0aW9uIChkYXRlTG9jYWxlKSB7CiAgICAgICAgcmV0dXJuIGkxOG4uZGF0ZUxvY2FsZSA9IGRhdGVMb2NhbGU7CiAgICAgIH0pOwogICAgICByZXR1cm4gaW1wb3J0KGBALy4uLy4uL2NvbmZpZy9sb2NhbGVzL2NsaWVudC4ke2xvb21pb0xvY2FsZShsb2NhbGUpfS55bWxgKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgZGF0YSA9IGRhdGFbbG9jYWxlXTsKICAgICAgICBsb2FkZWRMb2NhbGVzLnB1c2gobG9jYWxlKTsKICAgICAgICBpMThuLnNldExvY2FsZU1lc3NhZ2UobG9jYWxlLCBkYXRhKTsKICAgICAgICBzZXRJMThuTGFuZ3VhZ2UobG9jYWxlKTsKICAgICAgICByZXR1cm4gRXZlbnRCdXMuJGVtaXQoJ1Z1ZUZvcmNlVXBkYXRlJyk7CiAgICAgIH0pOwogICAgfQogIH0KfTsKCmV4cG9ydCBkZWZhdWx0IG5ldyAoU2Vzc2lvbiA9IGNsYXNzIFNlc3Npb24gewogIHJldHVyblRvKCkgewogICAgdmFyIGg7CiAgICBoID0gbmV3IFVSTCh3aW5kb3cubG9jYXRpb24uaHJlZik7CiAgICByZXR1cm4gaC5wYXRobmFtZSArIGguc2VhcmNoOwogIH0KCiAgZGVmYXVsdEZvcm1hdCgpIHsKICAgIGlmICh0aGlzLnVzZXIoKS5leHBlcmllbmNlc1snaHRtbC1lZGl0b3IudXNlcy1tYXJrZG93biddKSB7CiAgICAgIHJldHVybiAnbWQnOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICdodG1sJzsKICAgIH0KICB9CgogIGFwcGx5KGRhdGEpIHsKICAgIHZhciB1c2VyOwogICAgVnVlLnNldChBcHBDb25maWcsICdjdXJyZW50VXNlcklkJywgZGF0YS5jdXJyZW50X3VzZXJfaWQpOwogICAgVnVlLnNldChBcHBDb25maWcsICdwZW5kaW5nSWRlbnRpdHknLCBkYXRhLnBlbmRpbmdfaWRlbnRpdHkpOwogICAgUmVjb3Jkcy5pbXBvcnRKU09OKGRhdGEpOwogICAgdGhpcy51c2VySWQgPSBkYXRhLmN1cnJlbnRfdXNlcl9pZDsKICAgIHVzZXIgPSB0aGlzLnVzZXIoKTsKICAgIHRoaXMudXBkYXRlTG9jYWxlKHVzZXIubG9jYWxlKTsKCiAgICBpZiAodGhpcy5pc1NpZ25lZEluKCkpIHsKICAgICAgaWYgKHVzZXIudGltZVpvbmUgIT09IEFwcENvbmZpZy50aW1lWm9uZSkgewogICAgICAgIHVzZXIudGltZVpvbmUgPSBBcHBDb25maWcudGltZVpvbmU7CiAgICAgICAgUmVjb3Jkcy51c2Vycy51cGRhdGVQcm9maWxlKHVzZXIpOwogICAgICB9CgogICAgICBFdmVudEJ1cy4kZW1pdCgnc2lnbmVkSW4nLCB1c2VyKTsKICAgIH0KCiAgICByZXR1cm4gdXNlcjsKICB9CgogIHNpZ25PdXQoKSB7CiAgICBBcHBDb25maWcuY3VycmVudFVzZXJJZCA9IG51bGw7CiAgICByZXR1cm4gUmVjb3Jkcy5zZXNzaW9ucy5yZW1vdGUuZGVzdHJveSgnJykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBoYXJkUmVsb2FkKCcvJyk7CiAgICB9KTsKICB9CgogIGlzU2lnbmVkSW4oKSB7CiAgICByZXR1cm4gQXBwQ29uZmlnLmN1cnJlbnRVc2VySWQgJiYgdGhpcy51c2VyKCkucmVzdHJpY3RlZCA9PSBudWxsOwogIH0KCiAgdXNlcigpIHsKICAgIHJldHVybiBSZWNvcmRzLnVzZXJzLmZpbmQoQXBwQ29uZmlnLmN1cnJlbnRVc2VySWQpIHx8IFJlY29yZHMudXNlcnMuYnVpbGQoKTsKICB9CgogIGN1cnJlbnRHcm91cElkKCkgewogICAgcmV0dXJuIHRoaXMuY3VycmVudEdyb3VwICE9IG51bGwgJiYgdGhpcy5jdXJyZW50R3JvdXAuaWQ7CiAgfQoKICB1cGRhdGVMb2NhbGUobG9jYWxlKSB7CiAgICByZXR1cm4gbG9hZExvY2FsZShsb2NhbGUpOwogIH0KCiAgcHJvdmlkZXJJZGVudGl0eSgpIHsKICAgIHZhciB2YWxpZFByb3ZpZGVyczsKCiAgICBpZiAoIUFwcENvbmZpZy5wZW5kaW5nSWRlbnRpdHkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhbGlkUHJvdmlkZXJzID0gQXBwQ29uZmlnLmlkZW50aXR5UHJvdmlkZXJzLm1hcChmdW5jdGlvbiAocCkgewogICAgICByZXR1cm4gcC5uYW1lOwogICAgfSk7CgogICAgaWYgKHZhbGlkUHJvdmlkZXJzLmluY2x1ZGVzKEFwcENvbmZpZy5wZW5kaW5nSWRlbnRpdHkuaWRlbnRpdHlfdHlwZSkpIHsKICAgICAgcmV0dXJuIEFwcENvbmZpZy5wZW5kaW5nSWRlbnRpdHk7CiAgICB9CiAgfQoKfSkoKTs="},{"version":3,"sources":["/home/gustavo/Documents/tese/loomio/vue/src/shared/services/session.coffee"],"names":[],"mappings":";AAAA,IAAA,OAAA,EAAA,aAAA,EAAA,OAAA,EAAA,UAAA,EAAA,aAAA,EAAA,YAAA,EAAA,eAAA;AAAA,OAAA,SAAA,MAAA,8BAAA;AACA,OAAA,OAAA,MAAA,2BAAA;AACA,OAAA,aAAA,MAAA,mCAAA;AACA,OAAA,aAAA,MAAA,sCAAA;AACA,OAAA,QAAA,MAAA,6BAAA;AACA,OAAA,IAAA,MAAA,QAAA;AACA,OAAA,GAAA,MAAA,KAAA;AACA,SAAA,UAAA,QAAA,yBAAA;AAGA,aAAA,GAAgB,CAAA,IAAA,CAAhB;;AAEA,eAAA,GAAkB,UAAA,MAAA,EAAA;AAChB,EAAA,IAAI,CAAJ,MAAA,GAAc,MAAd;SACA,QAAQ,CAAR,aAAA,CAAA,MAAA,EAAA,YAAA,CAAA,MAAA,EAAA,MAAA,C;AAFgB,CAAlB;;AAIA,OAAA,GAAU,UAAA,MAAA,EAAA;AACV,MAAA,MAAA;AAAE,EAAA,MAAA,GAAS,MAAM,CAAN,OAAA,CAAA,GAAA,EAAA,GAAA,EAAA,KAAA,CAAA,GAAA,CAAT;SACA,SAAQ,CAAC,MAAM,CAAA,CAAA,CAAN,CAAD,WAAC,EAAD,EAA0B,MAAM,CAAN,CAAM,CAAN,IAAa,MAAM,CAAA,CAAA,CAAN,CAA/C,WAA+C,EAAvC,CAAR,EAAA,IAAA,CAAA,GAAA,C;AAFQ,CAAV;;AAIA,YAAA,GAAe,UAAA,MAAA,EAAA;SACb,MAAM,CAAN,OAAA,CAAA,GAAA,EAAA,GAAA,C;AADa,CAAf;;AAGA,aAAA,GAAgB,UAAA,MAAA,EAAA;AACd,MAAe,MAAM,CAAN,UAAA,CAAf,IAAe,CAAf,EAAA;AAAA,WAAA,IAAA;;;SACA,MAAM,CAAN,OAAA,CAAA,GAAA,EAAA,GAAA,C;AAFc,CAAhB;;AAIA,UAAA,GAAa,UAAA,MAAA,EAAA;AACX,MAAI,IAAI,CAAJ,MAAA,KAAJ,MAAA,EAAA;AACE,QAAG,aAAa,CAAb,QAAA,CAAH,MAAG,CAAH,EAAA;aACE,eAAA,CADF,MACE,C;AADF,KAAA,MAAA;AAGE,aAAO,mBAAmB,aAAA,CAAnB,MAAmB,CAA1B,WAAA,EAAA,IAAA,CAAiE,UAAA,UAAA,EAAA;eAC/D,IAAI,CAAJ,UAAA,GAAkB,U;AADpB,OAAA;aAEA,OAAO,iCAAiC,YAAA,CAAjC,MAAiC,CAAxC,MAAA,EAAA,IAAA,CAAyE,UAAA,IAAA,EAAA;AACvE,QAAA,IAAA,GAAO,IAAI,CAAA,MAAA,CAAX;AACA,QAAA,aAAa,CAAb,IAAA,CAAA,MAAA;AACA,QAAA,IAAI,CAAJ,gBAAA,CAAA,MAAA,EAAA,IAAA;AACA,QAAA,eAAA,CAAA,MAAA,CAAA;eACA,QAAQ,CAAR,KAAA,CAAA,gBAAA,C;AAVJ,OAKE,C;AANJ;;AADW,CAAb;;AAcA,eAAe,KAAU,OAAA,GAAN,MAAA,OAAA,CAAA;AACjB,EAAA,QAAU,GAAA;AACZ,QAAA,CAAA;AAAI,IAAA,CAAA,GAAI,IAAA,GAAA,CAAQ,MAAM,CAAC,QAAP,CAAR,IAAA,CAAJ;WACA,CAAC,CAAD,QAAA,GAAa,CAAC,CAAC,M;AAFP;;AAIV,EAAA,aAAe,GAAA;AACb,QAAG,KAAA,IAAA,GAAQ,WAAR,CAAH,2BAAG,CAAH,EAAA;aAAA,I;AAAA,KAAA,MAAA;aAAA,M;;AADa;;AAMf,EAAA,KAAO,CAAA,IAAA,EAAA;AACT,QAAA,IAAA;AAAI,IAAA,GAAG,CAAH,GAAA,CAAA,SAAA,EAAA,eAAA,EAAoC,IAAI,CAAxC,eAAA;AACA,IAAA,GAAG,CAAH,GAAA,CAAA,SAAA,EAAA,iBAAA,EAAsC,IAAI,CAA1C,gBAAA;AACA,IAAA,OAAO,CAAP,UAAA,CAAA,IAAA;AACA,SAAA,MAAA,GAAU,IAAI,CAAC,eAAf;AACA,IAAA,IAAA,GAAO,KAAA,IAAA,EAAP;AACA,SAAA,YAAA,CAAc,IAAI,CAAlB,MAAA;;AAEA,QAAG,KAAH,UAAG,EAAH,EAAA;AACE,UAAG,IAAI,CAAJ,QAAA,KAAiB,SAAS,CAA7B,QAAA,EAAA;AACE,QAAA,IAAI,CAAJ,QAAA,GAAgB,SAAS,CAAC,QAA1B;AACA,QAAA,OAAO,CAAC,KAAR,CAAA,aAAA,CAFF,IAEE;;;AACF,MAAA,QAAQ,CAAR,KAAA,CAAA,UAAA,EAJF,IAIE;;;WAEF,I;AAdK;;AAgBP,EAAA,OAAS,GAAA;AACP,IAAA,SAAS,CAAT,aAAA,GAA0B,IAA1B;WACA,OAAO,CAAC,QAAR,CAAiB,MAAjB,CAAA,OAAA,CAAA,EAAA,EAAA,IAAA,CAAyC,YAAA;aAAG,UAAA,CAAA,GAAA,C;AAA5C,KAAA,C;AAFO;;AAIT,EAAA,UAAY,GAAA;WACV,SAAS,CAAT,aAAA,IAA6B,KAAA,IAAA,GAAA,UAAA,IAAA,I;AADnB;;AAGZ,EAAA,IAAM,GAAA;WACJ,OAAO,CAAC,KAAR,CAAA,IAAA,CAAmB,SAAS,CAA5B,aAAA,KAA+C,OAAO,CAAC,KAAR,CAAA,KAAA,E;AAD3C;;AAGN,EAAA,cAAgB,GAAA;WACd,KAAA,YAAA,IAAA,IAAA,IAAkB,KAAC,YAAD,CAAc,E;AADlB;;AAGhB,EAAA,YAAc,CAAA,MAAA,EAAA;WACZ,UAAA,CAAA,MAAA,C;AADY;;AAGd,EAAA,gBAAkB,GAAA;AACpB,QAAA,cAAA;;AAAI,QAAA,CAAc,SAAS,CAAvB,eAAA,EAAA;AAAA;;;AACA,IAAA,cAAA,GAAiB,SAAS,CAAC,iBAAV,CAAA,GAAA,CAAgC,UAAA,CAAA,EAAA;aAAO,CAAC,CAAC,I;AAAzC,KAAA,CAAjB;;AACA,QAA6B,cAAc,CAAd,QAAA,CAAwB,SAAS,CAAC,eAAV,CAArD,aAA6B,CAA7B,EAAA;aAAA,SAAS,CAAT,e;;AAHgB;;AA3CD,CAAJ,GAAf","sourcesContent":["import AppConfig     from '@/shared/services/app_config'\nimport Records       from '@/shared/services/records'\nimport LmoUrlService from '@/shared/services/lmo_url_service'\nimport RestfulClient from '@/shared/record_store/restful_client'\nimport EventBus      from '@/shared/services/event_bus'\nimport i18n          from '@/i18n'\nimport Vue from 'vue'\nimport { hardReload } from '@/shared/helpers/window'\nimport { pickBy, identity, compact } from 'lodash'\n\nloadedLocales = ['en']\n\nsetI18nLanguage = (locale) ->\n  i18n.locale = locale\n  document.querySelector('html').setAttribute('lang', locale)\n\nfixCase = (locale) ->\n  splits = locale.replace('-', '_').split('_')\n  compact([splits[0].toLowerCase(), splits[1] && splits[1].toUpperCase()]).join('_')\n\nloomioLocale = (locale) ->\n  locale.replace('-', '_')\n\ndateFnsLocale = (locale) ->\n  return 'nl' if locale.startsWith('nl')\n  locale.replace('_','-')\n\nloadLocale = (locale) ->\n  if (i18n.locale != locale)\n    if loadedLocales.includes(locale)\n      setI18nLanguage(locale)\n    else\n      import(\"date-fns/locale/#{dateFnsLocale(locale)}/index.js\").then (dateLocale) ->\n        i18n.dateLocale = dateLocale\n      import(\"@/../../config/locales/client.#{loomioLocale(locale)}.yml\").then (data) ->\n        data = data[locale]\n        loadedLocales.push(locale)\n        i18n.setLocaleMessage(locale, data)\n        setI18nLanguage(locale)\n        EventBus.$emit('VueForceUpdate')\n\nexport default new class Session\n  returnTo: ->\n    h = new URL(window.location.href)\n    h.pathname + h.search\n    \n  defaultFormat: ->\n    if @user().experiences['html-editor.uses-markdown']\n      'md'\n    else\n      'html'\n\n  apply: (data) ->\n    Vue.set(AppConfig, 'currentUserId', data.current_user_id)\n    Vue.set(AppConfig, 'pendingIdentity', data.pending_identity)\n    Records.importJSON(data)\n    @userId = data.current_user_id\n    user = @user()\n    @updateLocale(user.locale)\n\n    if @isSignedIn()\n      if user.timeZone != AppConfig.timeZone\n        user.timeZone = AppConfig.timeZone\n        Records.users.updateProfile(user)\n      EventBus.$emit('signedIn', user)\n\n    user\n\n  signOut: ->\n    AppConfig.currentUserId = null\n    Records.sessions.remote.destroy('').then -> hardReload('/')\n\n  isSignedIn: ->\n    AppConfig.currentUserId and !@user().restricted?\n\n  user: ->\n    Records.users.find(AppConfig.currentUserId) or Records.users.build()\n\n  currentGroupId: ->\n    @currentGroup? && @currentGroup.id\n\n  updateLocale: (locale) ->\n    loadLocale(locale)\n\n  providerIdentity: ->\n    return unless AppConfig.pendingIdentity\n    validProviders = AppConfig.identityProviders.map (p) -> p.name\n    AppConfig.pendingIdentity if validProviders.includes(AppConfig.pendingIdentity.identity_type)\n"],"sourceRoot":""}]}